-- MySQL Script generated by MySQL Workbench
-- Tue Nov 27 22:00:19 2018
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema bd_gafe
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema bd_gafe
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `bd_gafe` DEFAULT CHARACTER SET utf8 ;
USE `bd_gafe` ;

-- -----------------------------------------------------
-- Table `bd_gafe`.`TBL_GENEROS`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_gafe`.`TBL_GENEROS` (
  `CODIGO_GENERO` INT NOT NULL,
  `NOMBRE_GENERO` VARCHAR(10) NOT NULL,
  PRIMARY KEY (`CODIGO_GENERO`))
ENGINE = InnoDB
COMMENT = 'IDENIFICA EL GENERO DE CADA USUARIO';


-- -----------------------------------------------------
-- Table `bd_gafe`.`TBL_TIPO_LUGARES`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_gafe`.`TBL_TIPO_LUGARES` (
  `CODIGO_TIPO_LUGAR` INT NOT NULL,
  `NOMBRE_TIPO_LUGAR` VARCHAR(45) NULL,
  PRIMARY KEY (`CODIGO_TIPO_LUGAR`))
ENGINE = InnoDB
COMMENT = 'ESTA TABLA DEFINE SI ES UN DEPARTAMENTO, UN PAIS, UNA PROVINCIA O UN ESTADO';


-- -----------------------------------------------------
-- Table `bd_gafe`.`TBL_LUGARES`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_gafe`.`TBL_LUGARES` (
  `CODIGO_LUGAR` INT NOT NULL,
  `NOMBRE_LUGAR` VARCHAR(50) NULL,
  `LONGITUD` VARCHAR(50) NULL,
  `LATITUD` VARCHAR(45) NULL,
  `CODIGO_TIPO_LUGAR` INT NOT NULL,
  `CODIGO_LUGAR_PADRE` INT NOT NULL,
  PRIMARY KEY (`CODIGO_LUGAR`),
 
  CONSTRAINT `fk_TBL_LUGARES_TBL_TIPO_LUGARES`
    FOREIGN KEY (`CODIGO_TIPO_LUGAR`)
    REFERENCES `bd_gafe`.`TBL_TIPO_LUGARES` (`CODIGO_TIPO_LUGAR`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_TBL_LUGARES_TBL_LUGARES`
    FOREIGN KEY (`CODIGO_LUGAR_PADRE`)
    REFERENCES `bd_gafe`.`TBL_LUGARES` (`CODIGO_LUGAR`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
COMMENT = 'ALMACENA LOS LUGARES DE DONDE ES CADA USUARIO';


-- -----------------------------------------------------
-- Table `bd_gafe`.`TBL_USUARIOS`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_gafe`.`TBL_USUARIOS` (
  `CODIGO_USUARIO` INT NOT NULL,
  `NOMBRE` VARCHAR(60) NOT NULL,
  `APELLIDOS` VARCHAR(60) NOT NULL,
  `CORREO` VARCHAR(50) NOT NULL,
  `CONTRASEÃ‘A` VARCHAR(45) NOT NULL,
  `FECHA_NACIMIENTO` DATE NULL,
  `BIOGRAFIA` VARCHAR(1000) NULL,
  `CODIGO_GENERO` INT NOT NULL,
  `CODIGO_LUGAR` INT NULL,
  `SITIO_WEB` VARCHAR(100) NULL,
  PRIMARY KEY (`CODIGO_USUARIO`),
 
  CONSTRAINT `fk_TBL_USUARIOS_TBL_GENEROS`
    FOREIGN KEY (`CODIGO_GENERO`)
    REFERENCES `bd_gafe`.`TBL_GENEROS` (`CODIGO_GENERO`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_TBL_USUARIOS_TBL_LUGARES`
    FOREIGN KEY (`CODIGO_LUGAR`)
    REFERENCES `bd_gafe`.`TBL_LUGARES` (`CODIGO_LUGAR`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
COMMENT = 'TABLA QUE GURDARA LOS DATOS DE LOS USUARIO SUSCRITOS';


-- -----------------------------------------------------
-- Table `bd_gafe`.`TBL_MENSAJES`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_gafe`.`TBL_MENSAJES` (
  `CODIGO_MENSAJE` INT NOT NULL,
  `CONTENIDO_MENSAJE` VARCHAR(500) NULL,
  `FECHA_MENSAJE` DATE NULL,
  `HORA_MENSAJE` TIME NULL,
  `CODIGO_USUARIO` INT NOT NULL,
  `CODIGO_USUARIO_AMIGO` INT NOT NULL,
  PRIMARY KEY (`CODIGO_MENSAJE`),
 CONSTRAINT `fk_TBL_MENSAJES_TBL_USUARIOS`
    FOREIGN KEY (`CODIGO_USUARIO`)
    REFERENCES `bd_gafe`.`TBL_USUARIOS` (`CODIGO_USUARIO`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_TBL_MENSAJES_TBL_USUARIOS2`
    FOREIGN KEY (`CODIGO_USUARIO_AMIGO`)
    REFERENCES `bd_gafe`.`TBL_USUARIOS` (`CODIGO_USUARIO`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
COMMENT = 'DETALLES DEL MENSAJE';


-- -----------------------------------------------------
-- Table `bd_gafe`.`TBL_ESTADO_CARPETAS_ARCHIVOS`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_gafe`.`TBL_ESTADO_CARPETAS_ARCHIVOS` (
  `CODIGO_ESTADO` INT NOT NULL,
  `NOMBRE_ESTADO` VARCHAR(45) NULL,
  PRIMARY KEY (`CODIGO_ESTADO`))
ENGINE = InnoDB
COMMENT = 'ESTA TABLA GUARDA LOS POSIBLES ESTADO DE UNA CARPETA O ARCHIVO COMO SER COMPARTIDO O NO COMPARTIDO';


-- -----------------------------------------------------
-- Table `bd_gafe`.`TBL_CARPETAS`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_gafe`.`TBL_CARPETAS` (
  `CODIGO_CARPETA` INT NOT NULL,
  `NOMBRE_CARPETA` VARCHAR(45) NOT NULL,
  `FECHA_CREACION` DATE NOT NULL,
  `CODIGO_ESTADO` INT NOT NULL,
  `CODIGO_USUARIO_PROPIETARIO` INT NOT NULL,
  PRIMARY KEY (`CODIGO_CARPETA`),

 CONSTRAINT `fk_TBL_CARPETAS_TBL_ESTADO_CARPETAS_ARCHIVOS`
    FOREIGN KEY (`CODIGO_ESTADO`)
    REFERENCES `bd_gafe`.`TBL_ESTADO_CARPETAS_ARCHIVOS` (`CODIGO_ESTADO`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_TBL_CARPETAS_TBL_USUARIOS`
    FOREIGN KEY (`CODIGO_USUARIO_PROPIETARIO`)
    REFERENCES `bd_gafe`.`TBL_USUARIOS` (`CODIGO_USUARIO`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
COMMENT = 'INFORMACION DETALLADA DE LAS CARPETAS';


-- -----------------------------------------------------
-- Table `bd_gafe`.`TBL_CARPETAS_COMPARTIDAS_X_USUARIO`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_gafe`.`TBL_CARPETAS_COMPARTIDAS_X_USUARIO` (
  `CODIGO_CARPETA` INT NOT NULL,
  `CODIGO_USUARIO` INT NOT NULL,
  `CODIGO_USUARIO_COMPARTIDO` INT NOT NULL,

 CONSTRAINT `fk_TBL_CARPETAS_COMPARTIDAS_X_USUARIO_TBL_CARPETAS`
    FOREIGN KEY (`CODIGO_CARPETA`)
    REFERENCES `bd_gafe`.`TBL_CARPETAS` (`CODIGO_CARPETA`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_TBL_CARPETAS_COMPARTIDAS_X_USUARIO_TBL_USUARIOS`
    FOREIGN KEY (`CODIGO_USUARIO`)
    REFERENCES `bd_gafe`.`TBL_USUARIOS` (`CODIGO_USUARIO`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_TBL_CARPETAS_COMPARTIDAS_X_USUARIO_TBL_USUARIOS2`
    FOREIGN KEY (`CODIGO_USUARIO_COMPARTIDO`)
    REFERENCES `bd_gafe`.`TBL_USUARIOS` (`CODIGO_USUARIO`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
COMMENT = 'TABLA QUE NOS PERMITE LLEVAR EL CONTROL DE LOS USUARIOS CON QUE SE HA COMPARTIDO UNA CARPETA';


-- -----------------------------------------------------
-- Table `bd_gafe`.`TBL_TIPO_ARCHIVOS`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_gafe`.`TBL_TIPO_ARCHIVOS` (
  `CODIGO_ARCHIVO` INT NOT NULL,
  `NOMBRE_TIPO_ARCHIVO` VARCHAR(45) NULL,
  PRIMARY KEY (`CODIGO_ARCHIVO`))
ENGINE = InnoDB
COMMENT = 'ESTA TABLA NOS INDICARA QUE TIPO DE ARCHIVO ES, POR EJEMPLO SI ES  HTML. CSS O JS';


-- -----------------------------------------------------
-- Table `bd_gafe`.`TBL_ARCHIVOS`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_gafe`.`TBL_ARCHIVOS` (
  `CODIGO_ARCHIVO` INT NOT NULL,
  `NOMBRE_ARCHIVO` VARCHAR(45) NULL,
  `FECHA_CREACION` DATE NULL,
  `CODIGO_TIPO_ARCHIVO` INT NOT NULL,
  `CODIGO_USUARIO` INT NOT NULL,
  `CODIGO_ESTADO` INT NOT NULL,
  PRIMARY KEY (`CODIGO_ARCHIVO`),

 CONSTRAINT `fk_TBL_ARCHIVOS_TBL_TIPO_ARCHIVOS`
    FOREIGN KEY (`CODIGO_ARCHIVO`)
    REFERENCES `bd_gafe`.`TBL_TIPO_ARCHIVOS` (`CODIGO_ARCHIVO`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_TBL_ARCHIVOS_TBL_USUARIOS`
    FOREIGN KEY (`CODIGO_USUARIO`)
    REFERENCES `bd_gafe`.`TBL_USUARIOS` (`CODIGO_USUARIO`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_TBL_ARCHIVOS_TBL_ESTADO_CARPETAS_ARCHIVOS`
    FOREIGN KEY (`CODIGO_ESTADO`)
    REFERENCES `bd_gafe`.`TBL_ESTADO_CARPETAS_ARCHIVOS` (`CODIGO_ESTADO`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `bd_gafe`.`TBL_PLANES`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_gafe`.`TBL_PLANES` (
  `CODIGO_PLAN` INT NOT NULL,
  `NOMBRE_PLAN` VARCHAR(80) NOT NULL COMMENT 'En esta tabla se almacenara los planes disponibles que se ofrecen a los usuarios suscritos en la plataforma',
  `DESCRIPCION` VARCHAR(200) NULL,
  `TAMANIO_ALMACENAMIENTO` INT NULL,
  `CANTIDAD_PROYECTOS` INT NULL,
  PRIMARY KEY (`CODIGO_PLAN`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `bd_gafe`.`TBL_TARJETA_CREDITO`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_gafe`.`TBL_TARJETA_CREDITO` (
  `CODIGO_TARGETA` INT NOT NULL,
  `NUMERO_TARJETA` INT NULL,
  `FECHA_VENCIMIENTO` DATE NULL,
  `CODIGO_SEGURIDAD` VARCHAR(20) NULL,
  PRIMARY KEY (`CODIGO_TARGETA`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `bd_gafe`.`TBL_HISTORIAL_PAGO`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `bd_gafe`.`TBL_HISTORIAL_PAGO` (
  `CODIGO_HISTORIAL` INT NOT NULL,
  `FECHA_PAGO` DATE NULL,
  `FECHA_FIN` DATE NULL,
  `CODIGO_PLAN` INT NOT NULL,
  `CODIGO_USUARIO` INT NOT NULL,
  `CODIGO_TARGETA` INT NOT NULL,
  PRIMARY KEY (`CODIGO_HISTORIAL`),
  
  CONSTRAINT `fk_TBL_HISTORIAL_PAGO_TBL_PLANES`
    FOREIGN KEY (`CODIGO_PLAN`)
    REFERENCES `bd_gafe`.`TBL_PLANES` (`CODIGO_PLAN`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_TBL_HISTORIAL_PAGO_TBL_USUARIOS`
    FOREIGN KEY (`CODIGO_USUARIO`)
    REFERENCES `bd_gafe`.`TBL_USUARIOS` (`CODIGO_USUARIO`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_TBL_HISTORIAL_PAGO_TBL_TARJETA_CREDITO`
    FOREIGN KEY (`CODIGO_TARGETA`)
    REFERENCES `bd_gafe`.`TBL_TARJETA_CREDITO` (`CODIGO_TARGETA`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
COMMENT = 'LLEVA EL CONTROL DE LOS PAGOS DEL LOS USUARIOS';


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
